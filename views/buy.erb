<nav class='account-menu'>
  <ul>
    <li><a href='/dashboard'>Dashboard</a></li>
    <li class='active'><a>Buy</a></li>
    <li><a href='/sell/btc'>Sell</a></li>
    <li><a href='/settings'>Settings</a></li>
  </ul>
</nav>


<div class='buy'>
  <h4>Currency</h4>
  <hr />
  <div class='buy-coin'>
    <a <%== buy_link(@coin, 'btc') %>>
      <button <%== class_active_status(@coin, 'btc')%>>
        Bitcoin
        <p id='counter-value'>@<%= format_usd(@current_btc_price) %></p>
      </button>
    </a>
    <a <%== buy_link(@coin, 'eth') %>>
      <button <%== class_active_status(@coin, 'eth')%>>
        Ether
        <p id='counter-value'>@<%= format_usd(@current_eth_price) %></p>
      </button>
    </a>
  </div>

  <h4>Amount</h4>
  <hr />
  <p>Your USD Balance: <b><%= format_usd(@usd_balance) %></b></p>
  
  <div class='currency-inputs'>
    <form action='/user/buy/<%=@coin%>' method='post'>
      <div id='usd-input-box'>
        <input type='number' min='1' max='999999' step='0.01' 
          id='usd-input' name='usd_amount' placeholder='0.00'> 
        <label for='usd-input'>USD</label>
      </div>

      <p id='arrow'>â‡Œ</p>

      <div>
        <input type='number' min='0' max='9999' step='0.000001' 
          id='<%=@coin%>-input' name='coin_amount' placeholder='0'>
        <label for='<%=@coin%>-input'><%= @coin.upcase %></label>
      </div>

      <div class='alert'>
        <p class='alert-limit'>Insufficient funds.</p>
      </div>

      <button class='submit-buy' type='submit'>
        Buy <%= CURRENCY_NAMES[@coin.to_sym] %>
      </button>
    </form>
  </div>
</div>

<script type='text/javascript'>
  $(document).ready(function(){

    var currentCoinPrice = '<%= current_prices[@coin.upcase]['USD'] %>';

    function alertFunds(value) {
      $('#usd-input-box').toggleClass('red-border', value > <%= @usd_balance %>);
      $('p.alert-limit').toggle(value > <%= @usd_balance %>);  
    };

    alertFunds(0);

    $('#usd-input').on('keyup', function() {
      var input = $(this).val();
      var correspCoinValue = (input / currentCoinPrice);

      alertFunds(input);

      $('#<%=@coin%>-input').val(correspCoinValue.toFixed(6));
    });

    $('#<%=@coin%>-input').on('keyup', function() {
      var input = $(this).val();
      var correspUsdValue = (input * currentCoinPrice);

      alertFunds(correspUsdValue);

      $('#usd-input').val(correspUsdValue.toFixed(2));
    });
  });
</script>